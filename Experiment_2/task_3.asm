; 将时钟改为倒计时，读拨码盘数据后倒计时
ORG 0000H
	LJMP START
	
ORG 000BH
	LJMP INTT0
	
ORG 0060H
	START:
	MOV TMOD,#01H
	MOV TH0,#4CH
	MOV TL0,#00H
	
; 读拨码盘并分别对31H、32H、33H、34H赋初值
	CLR P1.7
	MOV DPTR,#30BFFFH
	MOVX A,@DPTR
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 31H,A
	MOVX A,@DPTR
	SWAP A
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 32H,A
	
	SETB P1.7
	MOV DPTR,#30BFFFH
	MOVX A,@DPTR
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 33H,A
	MOVX A,@DPTR
	SWAP A
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 34H,A
	
	MOV 30H,#0H
	
	SETB EA
	SETB ET0
	SETB TR0
	
	MAIN_LOOP:
	CALL DISPLAY
	SJMP MAIN_LOOP
	
	INTT0:
	PUSH ACC
	PUSH PSW
	CLR TR0
	MOV TH0,#4CH
	MOV TL0,#00H
	INC 30H
	MOV A,30H
	CJNE A,#14H,EXIT
	
	MOV TH0,#4CH
	MOV 30H,#0H
	DEC 31H ; 将自加改为自减
	MOV A,31H
	CJNE A,#0FFH,EXIT ; 终止判断由#0AH变为#00FH
	
	MOV TH0,#4CH
	MOV 31H,#09H
	DEC 32H
	MOV A,32H
	CJNE A,#0FFH,EXIT
	
	MOV TH0,#4CH
	MOV 32H,#5H
	DEC 33H
	MOV A,33H
	CJNE A,#0FFH,EXIT
	
	MOV TH0,#4CH
	MOV 33H,#09H
	DEC 34H
	MOV A,34H
	CJNE A,#0FFH,EXIT
	
	EXIT:
	SETB TR0
	POP PSW
	POP ACC
	RETI
	
	DISPLAY:
	MOV A,31H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FF8H
	MOVX @DPTR,A
	
	MOV A,32H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FF9H
	MOVX @DPTR,A
	
	MOV A,33H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FFAH
	MOVX @DPTR,A
	
	MOV A,34H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FFBH
	MOVX @DPTR,A
	
	RET
	
	DSEG1:
	DB 0C0H,0F9H,0A4H,0B0H
	DB 99H,92H,82H,0F8H
	DB 80H,90H,88H,83H
	DB 0C6H,0A1H,86H,8EH
		
	END
