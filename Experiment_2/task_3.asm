; 将时钟改为倒计时，读拨码盘数据后倒计时
ORG 0000H
	LJMP START
	
ORG 000BH
	LJMP INTT0
	
ORG 0060H
	START:
	MOV TMOD,#01H
	MOV TH0,#4CH
	MOV TL0,#00H
	
	CLR P1.7
	MOV DPTR,#30BFFFH
	MOVX A,@DPTR
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 31H,A
	MOVX A,@DPTR
	SWAP A
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 32H,A
	
	SETB P1.7
	MOV DPTR,#30BFFFH
	MOVX A,@DPTR
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 33H,A
	MOVX A,@DPTR
	SWAP A
	CPL A
	MOV 30H,A
	ANL A,#0FH
	MOV 34H,A
	
	MOV 30H,#0H
	
	SETB EA
	SETB ET0
	SETB TR0
	
	MAIN_LOOP:
	CALL KEY
	CALL DISPLAY
	SJMP MAIN_LOOP
	
	INTT0:
	PUSH ACC
	PUSH PSW
	CLR TR0
	MOV TH0,#4CH
	MOV TL0,#00H
	INC 30H
	MOV A,30H
	CJNE A,#20,EXIT
	
	MOV TH0,#4CH
	MOV 30H,#0H
	DEC 31H
	MOV A,31H
	CJNE A,#0FFH,EXIT
	
	MOV TH0,#4CH
	MOV 31H,#09H
	DEC 32H
	MOV A,32H
	CJNE A,#0FFH,EXIT
	
	MOV TH0,#4CH
	MOV 32H,#5H
	DEC 33H
	MOV A,33H
	CJNE A,#0FFH,EXIT
	
	MOV TH0,#4CH
	MOV 33H,#09H
	DEC 34H
	MOV A,34H
	CJNE A,#0FFH,EXIT
	
	EXIT:
	SETB TR0
	POP PSW
	POP ACC
	RETI
	
	DISPLAY:
	MOV A,31H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FF8H
	MOVX @DPTR,A
	
	MOV A,32H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FF9H
	MOVX @DPTR,A
	
	MOV A,33H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FFAH
	MOVX @DPTR,A
	
	MOV A,34H
	MOV DPTR,#DSEG1
	MOVC A,@A+DPTR
	MOV DPTR,#7FFBH
	MOVX @DPTR,A
	
	RET
	
	KEY:
	JNB P1.0,PAUSE
	JNB P1.1,CONTINUE
	JNB P1.2,RESET
	RET
	
	PAUSE:
	CALL DELAY
	JB P1.0,EXIT_PAUSE
	CLR TR0
	EXIT_PAUSE:
	RET
	
	CONTINUE:
	CALL DELAY
	JB P1.1,EXIT_CONTINUE
	SETB TR0
	EXIT_CONTINUE:
	RET
	
	RESET:
	CALL DELAY
	JB P1.2,EXIT_RESET
	MOV 30H,#0H
	MOV 31H,#0H
	MOV 32H,#0H
	MOV 33H,#0H
	MOV 34H,#0H
	EXIT_RESET:
	RET
	
	DELAY:
	MOV R7,#0FFH
	DELAY_LOOP:
	NOP
	NOP
	NOP
	DJNZ R7,DELAY_LOOP
	RET
	
	DSEG1:
	DB 0C0H,0F9H,0A4H,0B0H
	DB 99H,92H,82H,0F8H
	DB 80H,90H,88H,83H
	DB 0C6H,0A1H,86H,8EH
		
	END
